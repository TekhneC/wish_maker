:root {
  color-scheme: dark;
  /* 背景色系：更深邃的午夜蓝 */
  --night-deep: #050b14;
  --night-mid: #0b1a3a;
  --night-glow: #1a3c6e;
  --night-bot: #16b5c4;
  
  /* 强调色 */
  --highlight: #ffd45a;
  
  /* 毛玻璃卡片风格 */
  --wish-bg: rgba(255, 255, 255, 0.12);
  --wish-border: rgba(255, 255, 255, 0.25);
  --wish-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  
  /* 文本颜色 */
  --text-primary: #ffffff;
  --text-secondary: rgba(255, 255, 255, 0.85);
  
  /* 输入框阴影 */
  --input-shadow: rgba(255, 255, 255, 0.35);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

@font-face {
  font-family: 'MyNewYearFont'; /* 你自己起的名字 */
  /* 这里的路径是相对于 css 文件的，或者用绝对路径 /static/fonts/... */
  src: url('/static/fonts/PingFangZhuiGuangTi-2.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap; /* 确保字体加载前显示默认字，防止文字隐形 */
}

body {
  font-family: "MyNewYearFont","PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
  background: var(--night-deep);
  color: var(--text-primary);
  min-height: 100vh;
  overflow: hidden; /* 禁止滚动，全屏展示 */
}

.sky {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* 1. 背景渐变层 (最底层) */
.gradient {
  position: absolute;
  inset: 0;
  background: 
    radial-gradient(circle at 50% 160%, var(--night-bot), transparent 50%),
    radial-gradient(circle at 50% 110%, var(--night-glow), transparent 60%),
    linear-gradient(to top, var(--night-mid), var(--night-deep));
  z-index: 0;
}

/* 2. 粒子画布层 (用于星空和烟花) */
#particle-canvas {
  position: absolute;
  inset: 0;
  z-index: 1;
  pointer-events: none; /* 确保不阻挡鼠标点击 */
}

/* 3. 装饰文字层 */
.firework-text {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column; /* 关键：改为纵向排列，支持两行文字 */
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 2;
  gap: 0px; /* 行间距 */
  
  /* 字体设定 */
  font-weight: 900;
  /* 稍微调整字体大小策略，兼顾两行显示 */
  font-size: clamp(100px, 9vw, 120px);
  letter-spacing: 0.12em;
  line-height: 1.2;
  
  /* --- 核心技巧：背景是重复的径向渐变（圆点），clip 到文字上 --- */
  color: transparent; /* 文字本身透明 */
  
  /* 金色与白色的粒子点阵 */
  background-image: 
    radial-gradient(circle, rgba(255, 230, 150, 0.9) 20%, transparent 25%),
    radial-gradient(circle, rgba(255, 255, 255, 0.8) 20%, transparent 25%);
    
  background-size: 6px 6px, 10px 10px; /* 两种不同大小的点阵 */
  background-position: 0 0, 3px 3px;
  
  /* 标准属性与 Webkit 前缀 */
  -webkit-background-clip: text;
  background-clip: text;
  
  /* 光晕效果：增强辉光感 */
  filter: drop-shadow(0 0 5px rgba(255, 210, 80, 0.4)) 
          drop-shadow(0 0 15px rgba(255, 210, 80, 0.2));
  
  /* 闪烁流动动画 */
  animation: shimmer 3s infinite linear;
}

/* 让背景图案移动，产生像火花流动的效果 */
@keyframes shimmer {
  0% { 
    background-position: 0 0, 3px 3px; 
    opacity: 0.8; 
  }
  50% { 
    opacity: 1; 
    filter: drop-shadow(0 0 8px rgba(255, 210, 80, 0.6)) 
            drop-shadow(0 0 20px rgba(255, 210, 80, 0.3));
  }
  100% { 
    background-position: 6px 6px, 13px 13px; 
    opacity: 0.8; 
  }
}

/* 强制清除 span 原有的装饰，只保留文字内容供父级裁切 */
.firework-text span {
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;
  margin: 0 !important;
  animation: none !important; /* 去掉之前的 sparkle 动画，避免冲突 */
  background: none !important;
}
/* 4. 寄语层 */
.wishes {
  position: absolute;
  inset: 0;
  pointer-events: none; /* 让鼠标事件穿透到下层的 input 或具体的 wish 上 */
  z-index: 10;
}

/* 单个寄语样式 (毛玻璃效果) */
.wish {
  position: absolute;
  padding: 12px 24px;
  background: var(--wish-bg);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px); /* Safari 支持 */
  border: 1px solid var(--wish-border);
  box-shadow: var(--wish-shadow), inset 0 0 12px rgba(255, 255, 255, 0.05);
  border-radius: 24px;
  
  color: var(--text-primary);
  font-size: 18px;
  font-weight: 400;
  line-height: 1.5;
  letter-spacing: 0.5px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  
  max-width: min(70vw, 500px);
  word-break: break-all;
  
  /* 交互属性 */
  pointer-events: auto; /* 允许点击 */
  cursor: default;
  user-select: none;
  
  /* 初始状态 (由 JS 控制进场) */
  opacity: 0;
  transform: scale(0.9);
  transition: opacity 0.5s ease, transform 0.3s ease, background 0.3s;
}

/* 悬停高亮 */
.wish:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.5);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  z-index: 20 !important; /* 悬停时置顶 */
}

/* 删除按钮 (右上角小红叉) */
.wish .close-btn {
  position: absolute;
  top: -6px;
  right: -6px;
  width: 24px;
  height: 24px;
  background: rgba(15, 231, 255, 0.9);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  
  /* 默认隐藏，悬停显示 */
  opacity: 0;
  transform: scale(0);
  transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

.wish:hover .close-btn {
  opacity: 1;
  transform: scale(1);
}

/* 5. 底部输入栏 */
.input-bar {
  position: absolute;
  left: 50%;
  bottom: 36px;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 12px;
  width: min(720px, 86vw);
  padding: 12px 16px 10px 40px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.94);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25), inset 0 0 12px var(--input-shadow);
  z-index: 50;
}

.input-bar input {
  flex: 2;
  padding: 4px;
  background: transparent;
  border: none;
  outline: none;
  font-size: 18px;
  font-family: 'MyNewYearFont';
  color: #1b2b47;
}

.input-bar input::placeholder {
  color: #7584a1;
}

/* 纸飞机发送按钮 */
.send-button {
  position: relative;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  background: var(--highlight);
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(255, 206, 92, 0.5);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  flex-shrink: 0;
}

.send-button:active {
  transform: scale(0.9);
  box-shadow: 0 3px 10px rgba(255, 206, 92, 0.35);
}

.send-button .plane {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-bottom: 18px solid #ffffff;
  transform: translate(-50%, -55%) rotate(45deg);
}

.send-button .trail {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: rgba(255, 239, 200, 0.9);
  opacity: 0;
}

/* 飞机飞行动画 */
.send-button.fly .plane {
  animation: fly 0.6s ease forwards;
}

.send-button.fly .trail {
  animation: trail 0.6s ease forwards;
}

@keyframes fly {
  0% { transform: translate(-50%, -55%) rotate(45deg); }
  70% { transform: translate(30px, -30px) rotate(45deg); opacity: 1; }
  100% { transform: translate(38px, -42px) rotate(45deg); opacity: 0; }
}

@keyframes trail {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.4); }
  40% { opacity: 0.8; transform: translate(-20%, -20%) scale(1); }
  100% { opacity: 0; transform: translate(10px, -10px) scale(1.4); }
}

/* 6. 右上角控制区 (开关) */
.controls {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 60;
}

.switch {
  position: relative;
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  padding: 8px 16px;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 20px;
  backdrop-filter: blur(4px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s;
  user-select: none;
}

.switch:hover {
  background: rgba(0, 0, 0, 0.6);
  border-color: rgba(255, 255, 255, 0.3);
}

.switch input {
  display: none;
}

.switch .slider {
  color: #ccc;
  font-size: 14px;
  font-weight: 500;
  transition: color 0.3s;
  display: flex;
  align-items: center;
  gap: 6px;
}

.switch input:checked + .slider {
  color: #ffd45a;
  text-shadow: 0 0 8px rgba(255, 212, 90, 0.6);
}

/* 移动端适配 */
@media (max-width: 768px) {
  .firework-text { font-size: 28px; }
  .wish { font-size: 14px; padding: 10px 16px; }
  .input-bar { width: 92vw; bottom: 20px; }
}

/* --- 游戏模式 HUD --- */
.game-hud {
  position: absolute;
  top: 20px;
  left: 20px;
  right: 20px;
  z-index: 100;
  display: flex;
  justify-content: space-between;
  align-items: center;
  pointer-events: none; /* 让点击穿透到下层，除非点按钮 */
}

.game-hud button {
  pointer-events: auto;
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.4);
  color: #fff;
  padding: 8px 16px;
  border-radius: 20px;
  cursor: pointer;
  backdrop-filter: blur(5px);
  transition: all 0.3s;
}

.game-hud button:hover {
  background: rgba(255, 255, 255, 0.4);
  transform: scale(1.05);
}

.hud-center {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.5);
  padding: 10px 30px;
  border-radius: 30px;
  color: #ffd700;
  font-weight: bold;
  font-size: 1.2rem;
  display: flex;
  gap: 20px;
  pointer-events: auto;
}

/* 游戏进行时，祝福卡片的样式变化 */
body.gaming .wish {
  cursor: crosshair; /* 变成瞄准光标 */
  border-color: #ffd700;
  animation: shake 0.5s infinite alternate; /* 可选：增加一点紧张感 */
}

/* 游戏时禁用关闭按钮，防止误删 */
body.gaming .wish .close-btn {
  display: none;
}

/* --- 结算模态框 --- */
/* --- 结算模态框 (POSTCARD STYLE) --- */
.modal-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.85);
  z-index: 1000;
  display: flex; justify-content: center; align-items: center;
  opacity: 0; pointer-events: none; transition: opacity 0.3s;
}
.modal-overlay.active { opacity: 1; pointer-events: auto; }

/* 模态框容器：左边是海报，右边是控制栏 (PC端) / 上下排列 (手机端) */
.modal-card {
  display: flex;
  flex-direction: column; /* 默认上下结构 */
  gap: 0;
  background: transparent;
  width: 340px;
  max-width: 90vw;
  transform: translateY(20px);
  transition: transform 0.3s;
}
.modal-overlay.active .modal-card { transform: translateY(0); }

/* --- 核心海报区域 --- */
/* --- 结算模态框 (横屏明信片样式) --- */
.modal-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.85);
  z-index: 1000;
  display: flex; justify-content: center; align-items: center;
  opacity: 0; pointer-events: none; transition: opacity 0.3s;
}
.modal-overlay.active { opacity: 1; pointer-events: auto; }

/* 模态框容器：加宽以适应横屏 */
.modal-card {
  display: flex;
  flex-direction: column;
  background: transparent;
  
  /* --- 关键修改：加宽 --- */
  width: 600px; 
  max-width: 95vw; /* 移动端适配 */
  
  transform: translateY(20px);
  transition: transform 0.3s;
}
.modal-overlay.active .modal-card { transform: translateY(0); }

/* --- 核心海报区域 (横屏) --- */
.postcard {
  position: relative;
  width: 100%;
  
  /* --- 关键修改：横屏比例 --- */
  /* 16 / 9 是标准宽屏 (如 1920x1080) */
  /* 如果你的图更方一点，可以改用 3 / 2 */
  aspect-ratio: 16 / 9; 
  
  background: url('../img/wish_maker.png') no-repeat center center;
  background-size: cover; /* 确保填满，可能会裁掉上下 */
  
  border-radius: 12px 12px 0 0;
  box-shadow: 0 10px 40px rgba(0,0,0,0.6);
  overflow: hidden;
}

/* 渐变遮罩：横屏时建议左侧加深，因为文字在左边 */
.postcard::after {
  content: "";
  position: absolute; inset: 0;
  background: linear-gradient(
      to right, /* 从左向右渐变 */
      rgba(0,0,0,0.6) 0%, 
      rgba(0,0,0,0.3) 40%,
      rgba(0,0,0,0) 100%
  );
  pointer-events: none;
}

/* 左上角：称号与分数 */
.poster-header {
  position: absolute;
  top: 25px;
  left: 25px;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 8px;
}

.badge {
  background: #e74c3c;
  color: #fff;
  padding: 4px 12px;
  border-radius: 4px;
  font-size: 0.9rem;
  font-weight: bold;
  letter-spacing: 1px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

.score-display {
  color: rgba(255,255,255,0.9);
  font-size: 0.85rem;
  text-shadow: 0 1px 2px rgba(0,0,0,0.8);
}

/* 左下角：主要寄语 */
.poster-footer {
  position: absolute;
  bottom: 30px;
  left: 25px;
  
  /* 限制文字宽度，不要遮挡住右边的背景插画细节 */
  width: 60%; 
  
  z-index: 2;
  text-align: left;
}

.wish-text-display {
  font-family: 'WishFont', sans-serif;
  font-size: 2rem; /* 横屏可以字体更大 */
  line-height: 1.3;
  color: #fff;
  text-shadow: 0 2px 4px rgba(0,0,0,0.9);
  margin: 0;
  white-space: pre-wrap;
}

/* --- 下方控制栏 (保持不变，只是宽度会随 modal-card 自动变宽) --- */
.modal-controls {
  background: #fff;
  padding: 15px 25px;
  border-radius: 0 0 12px 12px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.modal-controls input {
  width: 100%;
  padding: 12px;
  border: 1px solid #eee;
  background: #f8f8f8;
  border-radius: 6px;
  outline: none;
}
.modal-controls input:focus { background: #fff; border-color: #e74c3c; }
.btn-row { display: flex; gap: 10px; }
.save-btn {
  flex: 2;
  background: #e74c3c;
  color: #fff;
  border: none;
  padding: 12px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}
.close-btn {
  flex: 1;
  background: #f0f0f0;
  color: #666;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}